lattice: !Experiment
  exp_global: !ExpGlobal
    default_layer_dim: 32 # 512
    dropout: 0.3
  preproc: !PreprocRunner
    overwrite: False
    tasks:
    - !PreprocExtract
      in_files:
      - examples/data/fisher_dev.es.plf
      out_files:
      - examples/output/fisher_dev.es.xlat
      specs: !LatticeFromPlfExtractor {}
  model: !DefaultTranslator
    _xnmt_id: task1_model
    src_embedder: !LatticeEmbedder2
      _xnmt_id: task1_model_src_emb
      #emb_dim: 128
      #vocab: !Ref { name : src_vocab }
    encoder: !BiLatticeLSTMTransducer
      _xnmt_id: task1_model_enc
      layers: 2
    attender: !MlpAttender
      _xnmt_id: task1_model_att
    trg_embedder: !SimpleWordEmbedder
      _xnmt_id: task1_model_trg_emb
      emb_dim: 128
      vocab: !Ref { name : trg_vocab }
    decoder: !AutoRegressiveDecoder
      _xnmt_id: task1_model_dec
      rnn: !UniLSTMSeqTransducer
        layers: 1
      transform: !AuxNonLinear
        output_dim: 512
        activation: 'tanh'
      bridge: !CopyBridge {}
      scorer: !Softmax
        vocab: !Ref { name : trg_vocab }
    src_reader: !LatticeReader
      vocab: !Vocab
        _xnmt_id: src_vocab
        vocab_file: examples/data/fisher_dev.es.vocab
    trg_reader: !PlainTextReader
      _xnmt_id: task1_model_trg_reader
      vocab: !Vocab
        _xnmt_id: trg_vocab
        vocab_file: examples/data/fisher_dev.en.vocab
  train: !SimpleTrainingRegimen
    trainer: !AdamTrainer
      alpha: 0.0003
    run_for_epochs: 10
    batcher: !SrcBatcher
      batch_size: 1
    restart_trainer: True
    lr_decay: 0.8
    patience: 5
    src_file: examples/output/fisher_dev.es.xlat
    trg_file: examples/data/fisher_dev.en
    dev_tasks: &task1_model_dev_tasks
      - !AccuracyEvalTask
        eval_metrics: bleu
        src_file: examples/output/fisher_dev.es.xlat
        ref_file: examples/data/fisher_dev.en
        hyp_file: examples/output/{EXP}.dev_hyp
      - !LossEvalTask
        src_file: examples/output/fisher_dev.es.xlat
        ref_file: examples/data/fisher_dev.en
  evaluate:
    - !AccuracyEvalTask
      eval_metrics: bleu
      src_file: examples/output/fisher_dev.es.xlat
      ref_file: examples/data/fisher_dev.en
      hyp_file: examples/output/{EXP}.test_hyp
