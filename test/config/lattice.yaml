lattice: !Experiment
  exp_global: !ExpGlobal
    default_layer_dim: 32 # 512
    dropout: 0.3
  model: !DefaultTranslator
    _xnmt_id: task1_model
    src_embedder: !LatticeEmbedder
      _xnmt_id: task1_model_src_emb
      emb_dim: 128
      #arc_dropout: 0.5
      vocab: !Ref { name : src_vocab }
    encoder: !BiLatticeLSTMTransducer
      _xnmt_id: task1_model_enc
      layers: 2
    attender: !MlpAttender
      _xnmt_id: task1_model_att
    trg_embedder: !SimpleWordEmbedder
      _xnmt_id: task1_model_trg_emb
      emb_dim: 128
      vocab: !Ref { name : trg_vocab }
    decoder: !AutoRegressiveDecoder
      _xnmt_id: task1_model_dec
      rnn: !UniLSTMSeqTransducer
        layers: 1
      transform: !AuxNonLinear
        output_dim: 512
        activation: 'tanh'
      bridge: !CopyBridge {}
      scorer: !Softmax
        vocab: !Ref { name : trg_vocab }
    src_reader: !LatticeTextReader
      use_words: True
      use_chars: True
      use_pronun_from: ~
      vocab: !Vocab
        _xnmt_id: src_vocab
        vocab_file: examples/data/head.en.vocab
    trg_reader: !PlainTextReader
      _xnmt_id: task1_model_trg_reader
      vocab: !Vocab
        _xnmt_id: trg_vocab
        vocab_file: examples/data/head.ja.vocab
  train: !SimpleTrainingRegimen
    trainer: !AdamTrainer
      alpha: 0.0003
    run_for_epochs: 1
    batcher: !SrcBatcher
      batch_size: 1
    restart_trainer: True
    lr_decay: 0.8
    patience: 5
    src_file: &train_src_file examples/data/train.en
    trg_file: &train_trg_file examples/data/train.ja
    dev_tasks: &task1_model_dev_tasks
      - !AccuracyEvalTask
        eval_metrics: bleu
        src_file: examples/data/dev.en
        ref_file: examples/data/dev.ja
        hyp_file: examples/output/{EXP}.dev_hyp
      - !LossEvalTask
        src_file: examples/data/dev.en
        ref_file: examples/data/dev.ja
  evaluate:
    - !AccuracyEvalTask
      eval_metrics: bleu
      src_file: examples/data/test.en
      ref_file: examples/data/test.ja
      hyp_file: examples/output/{EXP}.test_hyp
